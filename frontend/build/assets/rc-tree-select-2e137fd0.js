import{t as Lr,K as te,B as Ir,b as Re,p as lr}from"./rc-util-49c06749.js";import{c as j,f as B,g as cr,h as dr,e as T,b as Kr,d as Tr}from"./@babel-43e769cc.js";import{r as t}from"./react-52c5f799.js";import{u as Vr,b as _r,B as Nr}from"./rc-select-04838821.js";import{T as Mr,c as Pr,d as Je}from"./rc-tree-9ea13a9a.js";import"./classnames-5da7e38f.js";import"./react-is-e8e5dbb3.js";var sr=t.createContext(null),fr=t.createContext(null);function Ar(e){return Array.isArray(e)?e:e!==void 0?[e]:[]}function Hr(e){var r=e||{},n=r.label,o=r.value,l=r.children,u=o||"value";return{_title:n?[n]:["title","label"],value:u,key:u,children:l||"children"}}function Ye(e){return!e||e.disabled||e.disableCheckbox||e.checkable===!1}function Or(e,r){var n=[];function o(l){l.forEach(function(u){var a=u[r.children];a&&(n.push(u[r.value]),o(a))})}return o(e),n}function ir(e){return e==null}var $r={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},Rr=function(r,n){var o=Vr(),l=o.prefixCls,u=o.multiple,a=o.searchValue,c=o.toggleOpen,i=o.open,s=o.notFoundContent,v=t.useContext(fr),w=v.virtual,x=v.listHeight,S=v.listItemHeight,V=v.treeData,L=v.fieldNames,M=v.onSelect,$=v.dropdownMatchSelectWidth,U=v.treeExpandAction,g=t.useContext(sr),I=g.checkable,_=g.checkedKeys,ne=g.halfCheckedKeys,O=g.treeExpandedKeys,We=g.treeDefaultExpandAll,me=g.treeDefaultExpandedKeys,ye=g.onTreeExpand,je=g.treeIcon,Be=g.showTreeIcon,Ce=g.switcherIcon,Se=g.treeLine,be=g.treeNodeFilterProp,Ee=g.loadData,ae=g.treeLoadedKeys,ke=g.treeMotion,xe=g.onTreeLoad,De=g.keyEntities,G=t.useRef(),le=Lr(function(){return V},[i,V],function(h,E){return E[0]&&h[1]!==E[1]}),we=t.useMemo(function(){return I?{checked:_,halfChecked:ne}:null},[I,_,ne]);t.useEffect(function(){if(i&&!u&&_.length){var h;(h=G.current)===null||h===void 0||h.scrollTo({key:_[0]})}},[i]);var ie=String(a).toLowerCase(),Le=function(E){return ie?String(E[be]).toLowerCase().includes(ie):!1},oe=t.useState(me),ue=j(oe,2),Q=ue[0],Ie=ue[1],Ke=t.useState(null),ce=j(Ke,2),de=ce[0],se=ce[1],Te=t.useMemo(function(){return O?B(O):a?de:Q},[Q,de,O,a]);t.useEffect(function(){a&&se(Or(V,L))},[a]);var Ue=function(E){Ie(E),se(E),ye&&ye(E)},J=function(E){E.preventDefault()},R=function(E,Y){var A=Y.node;I&&Ye(A)||(M(A.key,{selected:!_.includes(A.key)}),u||c(!1))},Ve=t.useState(null),P=j(Ve,2),fe=P[0],_e=P[1],N=De[fe];if(t.useImperativeHandle(n,function(){var h;return{scrollTo:(h=G.current)===null||h===void 0?void 0:h.scrollTo,onKeyDown:function(Y){var A,Ne=Y.which;switch(Ne){case te.UP:case te.DOWN:case te.LEFT:case te.RIGHT:(A=G.current)===null||A===void 0||A.onKeyDown(Y);break;case te.ENTER:{if(N){var Me=(N==null?void 0:N.node)||{},X=Me.selectable,Pe=Me.value;X!==!1&&R(null,{node:{key:fe},selected:!_.includes(Pe)})}break}case te.ESC:c(!1)}},onKeyUp:function(){}}}),le.length===0)return t.createElement("div",{role:"listbox",className:"".concat(l,"-empty"),onMouseDown:J},s);var ve={fieldNames:L};return ae&&(ve.loadedKeys=ae),Te&&(ve.expandedKeys=Te),t.createElement("div",{onMouseDown:J},N&&i&&t.createElement("span",{style:$r,"aria-live":"assertive"},N.node.value),t.createElement(Mr,cr({ref:G,focusable:!1,prefixCls:"".concat(l,"-tree"),treeData:le,height:x,itemHeight:S,virtual:w!==!1&&$!==!1,multiple:u,icon:je,showIcon:Be,switcherIcon:Ce,showLine:Se,loadData:a?null:Ee,motion:ke,activeKey:fe,checkable:I,checkStrictly:!0,checkedKeys:we,selectedKeys:I?[]:_,defaultExpandAll:We},ve,{onActiveChange:_e,onSelect:R,onCheck:R,onExpand:Ue,onLoad:xe,filterTreeNode:Le,expandAction:U})))},vr=t.forwardRef(Rr);vr.displayName="OptionList";var hr=function(){return null},Fr="SHOW_ALL",pr="SHOW_PARENT",ze="SHOW_CHILD";function or(e,r,n,o){var l=new Set(e);return r===ze?e.filter(function(u){var a=n[u];return!(a&&a.children&&a.children.some(function(c){var i=c.node;return l.has(i[o.value])})&&a.children.every(function(c){var i=c.node;return Ye(i)||l.has(i[o.value])}))}):r===pr?e.filter(function(u){var a=n[u],c=a?a.parent:null;return!(c&&!Ye(c.node)&&l.has(c.key))}):e}var Wr=["children","value"];function gr(e){return Ir(e).map(function(r){if(!t.isValidElement(r)||!r.type)return null;var n=r,o=n.key,l=n.props,u=l.children,a=l.value,c=dr(l,Wr),i=T({key:o,value:a},c),s=gr(u);return s.length&&(i.children=s),i}).filter(function(r){return r})}function qe(e){if(!e)return e;var r=T({},e);return"props"in r||Object.defineProperty(r,"props",{get:function(){return Re(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),r}}),r}function jr(e,r,n,o,l,u){var a=null,c=null;function i(){function s(v){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",x=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return v.map(function(S,V){var L="".concat(w,"-").concat(V),M=S[u.value],$=n.includes(M),U=s(S[u.children]||[],L,$),g=t.createElement(hr,S,U.map(function(_){return _.node}));if(r===M&&(a=g),$){var I={pos:L,node:g,children:U};return x||c.push(I),I}return null}).filter(function(S){return S})}c||(c=[],s(o),c.sort(function(v,w){var x=v.node.props.value,S=w.node.props.value,V=n.indexOf(x),L=n.indexOf(S);return V-L}))}Object.defineProperty(e,"triggerNode",{get:function(){return Re(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),i(),a}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return Re(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),i(),l?c:c.map(function(v){var w=v.node;return w})}})}function Br(e,r){var n=r.id,o=r.pId,l=r.rootPId,u={},a=[],c=e.map(function(i){var s=T({},i),v=s[n];return u[v]=s,s.key=s.key||v,s});return c.forEach(function(i){var s=i[o],v=u[s];v&&(v.children=v.children||[],v.children.push(i)),(s===l||!v&&l===null)&&a.push(i)}),a}function Ur(e,r,n){return t.useMemo(function(){return e?n?Br(e,T({id:"id",pId:"pId",rootPId:null},n!==!0?n:{})):e:gr(r)},[r,n,e])}const Gr=function(e){var r=t.useRef({valueLabels:new Map});return t.useMemo(function(){var n=r.current.valueLabels,o=new Map,l=e.map(function(u){var a,c=u.value,i=(a=u.label)!==null&&a!==void 0?a:n.get(c);return o.set(c,i),T(T({},u),{},{label:i})});return r.current.valueLabels=o,[l]},[e])};function ur(e){var r=t.useRef();r.current=e;var n=t.useCallback(function(){return r.current.apply(r,arguments)},[]);return n}const Jr=function(e,r){return t.useMemo(function(){var n=Pr(e,{fieldNames:r,initWrapper:function(l){return T(T({},l),{},{valueEntities:new Map})},processEntity:function(l,u){var a=l.node[r.value];u.valueEntities.set(a,l)}});return n},[e,r])},Yr=function(e,r,n,o){return t.useMemo(function(){var l=e.map(function(i){var s=i.value;return s}),u=r.map(function(i){var s=i.value;return s}),a=l.filter(function(i){return!o[i]});if(n){var c=Je(l,!0,o);l=c.checkedKeys,u=c.halfCheckedKeys}return[Array.from(new Set([].concat(B(a),B(l)))),u]},[e,r,n,o])},qr=function(e,r,n){var o=n.treeNodeFilterProp,l=n.filterTreeNode,u=n.fieldNames,a=u.children;return t.useMemo(function(){if(!r||l===!1)return e;var c;if(typeof l=="function")c=l;else{var i=r.toUpperCase();c=function(w,x){var S=x[o];return String(S).toUpperCase().includes(i)}}function s(v){var w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return v.reduce(function(x,S){var V=S[a],L=w||c(r,qe(S)),M=s(V||[],L);return(L||M.length)&&x.push(T(T({},S),{},Kr({isLeaf:void 0},a,M))),x},[])}return s(e)},[e,r,a,o,l])};var zr=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion"];function Qr(e){return!e||Tr(e)!=="object"}var Xr=t.forwardRef(function(e,r){var n=e.id,o=e.prefixCls,l=o===void 0?"rc-tree-select":o,u=e.value,a=e.defaultValue,c=e.onChange,i=e.onSelect,s=e.onDeselect,v=e.searchValue,w=e.inputValue,x=e.onSearch,S=e.autoClearSearchValue,V=S===void 0?!0:S,L=e.filterTreeNode,M=e.treeNodeFilterProp,$=M===void 0?"value":M,U=e.showCheckedStrategy,g=U===void 0?ze:U,I=e.treeNodeLabelProp,_=e.multiple,ne=e.treeCheckable,O=e.treeCheckStrictly,We=e.labelInValue,me=e.fieldNames,ye=e.treeDataSimpleMode,je=e.treeData,Be=e.children,Ce=e.loadData,Se=e.treeLoadedKeys,be=e.onTreeLoad,Ee=e.treeDefaultExpandAll,ae=e.treeExpandedKeys,ke=e.treeDefaultExpandedKeys,xe=e.onTreeExpand,De=e.treeExpandAction,G=e.virtual,le=e.listHeight,we=le===void 0?200:le,ie=e.listItemHeight,Le=ie===void 0?20:ie,oe=e.onDropdownVisibleChange,ue=e.dropdownMatchSelectWidth,Q=ue===void 0?!0:ue,Ie=e.treeLine,Ke=e.treeIcon,ce=e.showTreeIcon,de=e.switcherIcon,se=e.treeMotion,Te=dr(e,zr),Ue=_r(n),J=ne&&!O,R=ne||O,Ve=O||We,P=R||_,fe=lr(a,{value:u}),_e=j(fe,2),N=_e[0],ve=_e[1],h=t.useMemo(function(){return Hr(me)},[JSON.stringify(me)]),E=lr("",{value:v!==void 0?v:w,postState:function(d){return d||""}}),Y=j(E,2),A=Y[0],Ne=Y[1],Me=function(d){Ne(d),x==null||x(d)},X=Ur(je,Be,ye),Pe=Jr(X,h),K=Pe.keyEntities,q=Pe.valueEntities,Qe=t.useCallback(function(f){var d=[],p=[];return f.forEach(function(m){q.has(m)?p.push(m):d.push(m)}),{missingRawValues:d,existRawValues:p}},[q]),Xe=qr(X,A,{fieldNames:h,treeNodeFilterProp:$,filterTreeNode:L}),Ze=t.useCallback(function(f){if(f){if(I)return f[I];for(var d=h._title,p=0;p<d.length;p+=1){var m=f[d[p]];if(m!==void 0)return m}}},[h,I]),he=t.useCallback(function(f){var d=Ar(f);return d.map(function(p){return Qr(p)?{value:p}:p})},[]),Ae=t.useCallback(function(f){var d=he(f);return d.map(function(p){var m=p.label,D=p.value,b=p.halfChecked,y,C=q.get(D);if(C){var k;m=(k=m)!==null&&k!==void 0?k:Ze(C.node),y=C.node.disabled}else if(m===void 0){var F=he(N).find(function(pe){return pe.value===D});m=F.label}return{label:m,value:D,halfChecked:b,disabled:y}})},[q,Ze,he,N]),er=t.useMemo(function(){return he(N)},[he,N]),mr=t.useMemo(function(){var f=[],d=[];return er.forEach(function(p){p.halfChecked?d.push(p):f.push(p)}),[f,d]},[er]),rr=j(mr,2),Z=rr[0],tr=rr[1],nr=t.useMemo(function(){return Z.map(function(f){return f.value})},[Z]),yr=Yr(Z,tr,J,K),ar=j(yr,2),ee=ar[0],He=ar[1],Cr=t.useMemo(function(){var f=or(ee,g,K,h),d=f.map(function(b){var y,C,k;return(y=(C=K[b])===null||C===void 0||(k=C.node)===null||k===void 0?void 0:k[h.value])!==null&&y!==void 0?y:b}),p=d.map(function(b){var y=Z.find(function(C){return C.value===b});return{value:b,label:y==null?void 0:y.label}}),m=Ae(p),D=m[0];return!P&&D&&ir(D.value)&&ir(D.label)?[]:m.map(function(b){var y;return T(T({},b),{},{label:(y=b.label)!==null&&y!==void 0?y:b.value})})},[h,P,ee,Z,Ae,g,K]),Sr=Gr(Cr),br=j(Sr,1),Er=br[0],Oe=ur(function(f,d,p){var m=Ae(f);if(ve(m),V&&Ne(""),c){var D=f;if(J){var b=or(f,g,K,h);D=b.map(function(H){var W=q.get(H);return W?W.node[h.value]:H})}var y=d||{triggerValue:void 0,selected:void 0},C=y.triggerValue,k=y.selected,F=D;if(O){var pe=tr.filter(function(H){return!D.includes(H.value)});F=[].concat(B(F),B(pe))}var ge=Ae(F),z={preValue:Z,triggerValue:C},re=!0;(O||p==="selection"&&!k)&&(re=!1),jr(z,C,f,X,re,h),R?z.checked=k:z.selected=k;var $e=Ve?ge:ge.map(function(H){return H.value});c(P?$e:$e[0],Ve?null:ge.map(function(H){return H.label}),z)}}),Ge=t.useCallback(function(f,d){var p,m=d.selected,D=d.source,b=K[f],y=b==null?void 0:b.node,C=(p=y==null?void 0:y[h.value])!==null&&p!==void 0?p:f;if(!P)Oe([C],{selected:!0,triggerValue:C},"option");else{var k=m?[].concat(B(nr),[C]):ee.filter(function(W){return W!==C});if(J){var F=Qe(k),pe=F.missingRawValues,ge=F.existRawValues,z=ge.map(function(W){return q.get(W).key}),re;if(m){var $e=Je(z,!0,K);re=$e.checkedKeys}else{var H=Je(z,{checked:!1,halfCheckedKeys:He},K);re=H.checkedKeys}k=[].concat(B(pe),B(re.map(function(W){return K[W].node[h.value]})))}Oe(k,{selected:m,triggerValue:C},D||"option")}m||!P?i==null||i(C,qe(y)):s==null||s(C,qe(y))},[Qe,q,K,h,P,nr,Oe,J,i,s,ee,He]),kr=t.useCallback(function(f){if(oe){var d={};Object.defineProperty(d,"documentClickClose",{get:function(){return Re(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),oe(f,d)}},[oe]),xr=ur(function(f,d){var p=f.map(function(m){return m.value});if(d.type==="clear"){Oe(p,{},"selection");return}d.values.length&&Ge(d.values[0].value,{selected:!1,source:"selection"})}),Dr=t.useMemo(function(){return{virtual:G,dropdownMatchSelectWidth:Q,listHeight:we,listItemHeight:Le,treeData:Xe,fieldNames:h,onSelect:Ge,treeExpandAction:De}},[G,Q,we,Le,Xe,h,Ge,De]),wr=t.useMemo(function(){return{checkable:R,loadData:Ce,treeLoadedKeys:Se,onTreeLoad:be,checkedKeys:ee,halfCheckedKeys:He,treeDefaultExpandAll:Ee,treeExpandedKeys:ae,treeDefaultExpandedKeys:ke,onTreeExpand:xe,treeIcon:Ke,treeMotion:se,showTreeIcon:ce,switcherIcon:de,treeLine:Ie,treeNodeFilterProp:$,keyEntities:K}},[R,Ce,Se,be,ee,He,Ee,ae,ke,xe,Ke,se,ce,de,Ie,$,K]);return t.createElement(fr.Provider,{value:Dr},t.createElement(sr.Provider,{value:wr},t.createElement(Nr,cr({ref:r},Te,{id:Ue,prefixCls:l,mode:P?"multiple":void 0,displayValues:Er,onDisplayValuesChange:xr,searchValue:A,onSearch:Me,OptionList:vr,emptyOptions:!X.length,onDropdownVisibleChange:kr,dropdownMatchSelectWidth:Q}))))}),Fe=Xr;Fe.TreeNode=hr;Fe.SHOW_ALL=Fr;Fe.SHOW_PARENT=pr;Fe.SHOW_CHILD=ze;export{Fe as G,Fr as S,hr as T,pr as a,ze as b};
